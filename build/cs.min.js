/**
 * @file
 * A DOM manipilation utility library for the version of IPB running on the
 * free forum hosting service, Jcink, that reads table information and accepts
 * a user-defined template for text replacement. Allows for the structuring
 * of forums in nontraditional, table-less layouts. Visible credits are not
 * required provided this entire comment block remains intact.
 * @author      Connor Wiseman
 * @copyright   2012-2015 Connor Wiseman
 * @version     1.8.1 (March 2016)
 * @license
 * Copyright (c) 2012-2016 Connor Wiseman
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the 'Software'), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED 'AS IS', WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */
"use strict";var $cs=$cs||{extendModule:function(a,b){a.prototype=new b,a.prototype.constructor=a.prototype.myParent},module:{Default:function(){},Index:function(){},Stats:function(){},Profile:function(){},Topics:function(){},Posts:function(){}}};$cs.module.Default.prototype.time=!1,$cs.module.Default.prototype.html="",$cs.module.Default.prototype.values={},$cs.module.Default.prototype.getValue=function(a){var a=this.config.keyPrefix+a+this.config.keySuffix;return this.values[a]},$cs.module.Default.prototype.hasValue=function(a){var a=this.config.keyPrefix+a+this.config.keySuffix;return this.values[a]&&""!==this.values[a]},$cs.module.Default.prototype.initialize=function(a){if(a=a||{},!Object.keys(a).length)return console.error(this.name+': init method missing required argument "settings"'),!1;for(var b in a)if(-1===this.reserved.indexOf(b))if("object"==typeof a[b])for(var c in a[b])b in this&&(this[b][c]=a[b][c]);else b in this&&(this[b]=a[b]);return this.html&&""!==this.html?(this.time&&console.time(this.name),this.values={},this.execute(),this.time&&console.timeEnd(this.name),void 0):(console.error(this.name+': required property "html" is undefined'),!1)},$cs.module.Default.prototype.replaceValues=function(a,b){if(a="function"==typeof a?a.call(this):a,"undefined"==typeof a)return console.error(this.name+': function "html" returns null'),null;var c=new RegExp(Object.keys(b).join("|"),"g");return a.replace(c,function(a){return b[a]})},$cs.module.Default.prototype.setValue=function(a,b){this.values[this.config.keyPrefix+a+this.config.keySuffix]=b},$cs.extendModule($cs.module.Index,$cs.module.Default),$cs.module.Index.prototype.config={target:"board",keyPrefix:"{{",keySuffix:"}}",insertBefore:"",insertAfter:"",viewingDefault:"0",subforumSeparator:", ",subforumsNone:"",moderatorsNone:"",dateDefault:"--",titleDefault:"----",urlDefault:"#",authorDefault:"",passwordTitle:"Protected Forum"},$cs.module.Index.prototype.name="$cs.module.Index",$cs.module.Index.prototype.reserved=["values","makeLink","execute","getValue","hasValue","initialize","readTable","replaceValues","setValue"],$cs.module.Index.prototype.execute=function(){var a=document.getElementById(this.config.container),b=document.getElementById("subforum-list"),c=(a||document).getElementsByClassName("category");if(c.length)for(var d=0;d<c.length;d++){var e=c[d].lastChild.previousSibling,f=e.firstElementChild;this.readTable(f,d)}else if(b){var f=b.firstElementChild;this.readTable(f,0)}},$cs.module.Index.prototype.initialize=function(a){$cs.module.Default.prototype.initialize.call(this,a)},$cs.module.Index.prototype.makeLink=function(a){return"<a href='"+a+"'>"+a.innerHTML+"</a>"},$cs.module.Index.prototype.readTable=function(a,b){var c=a.getElementsByTagName("tr");a.style.display="none";var d="";this.config.insertBefore&&""!==this.config.insertBefore&&(d+='<div class="new-category-before">'+this.config.insertBefore+"</div>");for(var e=1,f=c.length-1;f>e;e++){var g=c[e].getElementsByTagName("td");this.setValue("forumMarker",g[0].innerHTML),this.setValue("forumTitle",g[1].firstElementChild.innerHTML);var h=g[1].getElementsByClassName("x-viewing-forum")[0];h?this.setValue("forumViewing",h.innerHTML.split("(")[1].split(" Vi")[0]):this.setValue("forumViewing",this.config.viewingDefault),this.setValue("forumId",this.values["{{forumTitle}}"].split("showforum=")[1].split('" alt="')[0]),this.setValue("forumDescription",g[1].getElementsByClassName("forum-desc")[0].innerHTML);var i=g[1].getElementsByClassName("subforums")[0],j="";if(i){for(var k=i.getElementsByTagName("a"),l=1,m=k.length;m>l;l+=2){var n=this.makeLink(k[l]);j+=l===m-1?n:n+this.config.subforumSeparator}this.setValue("subforums",j)}else this.setValue("subforums",this.config.subforumsNone);var o=g[1].getElementsByClassName("forum-led-by")[0];o&&o.textContent?(this.setValue("moderators",o.innerHTML.split("Forum Led by:  ")[1]),this.setValue("redirectHits",0)):o?this.setValue("redirectHits",0):(this.setValue("moderators",this.config.moderatorsNone),this.setValue("redirectHits",g[4].textContent.split("Redirected Hits: ")[1])),this.setValue("topicCount",g[2].textContent),this.setValue("replyCount",g[3].textContent);var p=g[4],q=p.getElementsByTagName("a");q.length>0?(this.setValue("lastPostDate",p.childNodes[0].nodeValue),-1===p.textContent.indexOf("Protected Forum")?(this.setValue("lastPostTitle",this.makeLink(q[1])),this.setValue("lastPostURL",q[1].href.slice(0,-16)),q[2]?this.setValue("lastPostAuthor",this.makeLink(q[2])):this.setValue("lastPostAuthor",p.textContent.split("By: ")[1])):(this.setValue("lastPostTitle",this.config.passwordTitle),this.setValue("lastPostURL",this.config.urlDefault),this.setValue("lastPostAuthor",this.makeLink(q[0])))):(this.setValue("lastPostDate",this.config.dateDefault),this.setValue("lastPostTitle",this.config.titleDefault),this.setValue("lastPostURL",this.config.urlDefault),this.setValue("lastPostAuthor",this.config.authorDefault));var r="";-1!==this.values["{{forumMarker}}"].indexOf("<a ")&&(r=" has-new-posts"),d+='<div id="row-'+this.values["{{forumId}}"]+'" class="new-row'+r+'">'+this.replaceValues(this.html,this.values)+"</div>"}this.config.insertAfter&&""!==this.config.insertAfter&&(d+='<div class="new-category-after">'+this.config.insertAfter+"</div>");var s=document.createElement("div");s.innerHTML=d,s.id="category-"+(b+1),s.className="new-category",a.parentNode.appendChild(s),a.parentNode.removeChild(a)},$cs.extendModule($cs.module.Stats,$cs.module.Default),$cs.module.Stats.prototype.config={keyPrefix:"{{",keySuffix:"}}"},$cs.module.Stats.prototype.name="$cs.module.Stats",$cs.module.Stats.prototype.reserved=["values","execute","getValue","hasValue","initialize","replaceValues","setValue"],$cs.module.Stats.prototype.execute=function(){var a=document.getElementById("boardstats");if(a){var b=a.lastElementChild;b.style.display="none";for(var c=b.getElementsByTagName("td"),d=0,e=c.length;e>d;d+=3)switch(!0){case-1!==c[d].textContent.indexOf("active in the past"):this.setValue("totalUsers",c[d].textContent.split(" user")[0]);var f=c[d+2].getElementsByTagName("b");this.setValue("totalUsersGuests",f[0].textContent),this.setValue("totalUsersRegistered",f[1].textContent),this.setValue("totalUsersAnonymous",f[2].textContent);var g=c[d+2].getElementsByClassName("thin")[0];this.setValue("onlineList",g.innerHTML.split("<br><br>")[0]),this.setValue("onlineLegend",g.innerHTML.split("<br><br>")[1]),this.setValue("activityLinkClick",'<a href="/?act=Online&amp;CODE=listall&amp;sort_key=click">Last Click</a>'),this.setValue("activityLinkMemberName",'<a href="?act=Online&amp;CODE=listall&amp;sort_key=name&amp;sort_order=asc&amp;show_mem=reg">Member Name</a>');break;case"Today's"===c[d].textContent.slice(0,7):var h=c[d+2].getElementsByTagName("b");h.length>1?(this.setValue("birthdays",h[0].textContent),this.setValue("birthdaysList",c[d+2].innerHTML.split("<br>")[1])):(this.setValue("birthdays","0"),this.setValue("birthdaysList",c[d+2].textContent));break;case"Forthcoming"===c[d].textContent.slice(0,11):this.setValue("events",c[d+2].innerHTML);break;case"Board"===c[d].textContent.slice(0,5):var i=c[d+2].getElementsByTagName("b");this.setValue("totalPosts",i[0].textContent),this.setValue("totalMembers",i[1].textContent),this.setValue("newestMember",i[2].innerHTML),this.setValue("mostOnline",i[3].textContent),this.setValue("mostOnlineDate",i[4].textContent);break;case"Members"===c[d].textContent.slice(0,7):this.setValue("onlineToday",c[d].textContent.split(": ")[1].split(" [")[0]),this.setValue("onlineTodayList",c[d+2].innerHTML.split(":</span><br>")[1]);var j=c[d+2].getElementsByTagName("b");this.setValue("mostOnlineOneDay",j[0].textContent),this.setValue("mostOnlineDateOneDay",j[1].textContent);break;case"IBStore"===c[d].textContent.slice(0,7):var k=c[d+2].getElementsByTagName("b");this.setValue("storeProducts",k[0].textContent),this.setValue("storeValue",k[1].textContent),this.setValue("moneyTotal",k[2].textContent),this.setValue("moneyBanked",k[3].textContent),this.setValue("moneyCirculating",k[4].textContent),this.setValue("richestMember",k[5].innerHTML),this.setValue("richestMemberValue",k[6].textContent)}var l=document.createElement("div");l.innerHTML=this.replaceValues(this.html,this.values),l.id="new-statistics",b.parentNode.appendChild(l),b.parentNode.removeChild(b)}},$cs.module.Stats.prototype.initialize=function(a){$cs.module.Default.prototype.initialize.call(this,a)},$cs.extendModule($cs.module.Profile,$cs.module.Default),$cs.module.Profile.prototype.config={htmlEnabled:!1,keyPrefix:"{{",keySuffix:"}}",emailDefault:"Click here",messageDefault:"Click here",reputationIncrease:"+",reputationDecrease:"-",warnIncrease:"+",warnDecrease:"-",reputationDetails:"[details >>]",avatarDefault:"",userPhotoDefault:"",onlineActivityDefault:"",customFieldsInnerHTML:!1},$cs.module.Profile.prototype.name="$cs.module.Profile",$cs.module.Profile.prototype.reserved=["values","execute","getValue","hasValue","initialize","replaceValues","setValue","stringToMarkup"],$cs.module.Profile.prototype.execute=function(){var a=document.getElementById("profile-heading"),b=document.getElementById("profilename");if(a){var c=a.parentNode.parentNode.parentNode.parentNode,d=document.getElementById("profile-personalinfo"),e=document.getElementById("profile-customfields"),f=document.getElementById("profile-statistics"),g=document.getElementById("profile-contactinfo"),h=document.getElementById("sig_popup"),i=document.getElementById("profile-header");c.style.display="none";var j=location.href.split("?showuser=")[1];this.setValue("userId",j);var k=d.getElementsByTagName("div"),l=k[2].getElementsByTagName("img")[0];l?this.setValue("userPhoto",l.src):this.setValue("userPhoto",this.config.userPhotoDefault);var m=k[4].textContent.split("%")[0];""!==m&&(this.setValue("warnLevel",m),this.setValue("warnLevelIncrease",'<a href="/?act=warn&type=add&mid='+j+'">'+this.config.warnIncrease+"</a>"),this.setValue("warnLevelDecrease",'<a href="/?act=warn&type=minus&mid='+j+'">'+this.config.warnDecrease+"</a>"));var n=0;if("Options"!==k[5].textContent){n=1;var o=k[5].textContent.split("] ")[1].split(" pts")[0];""!==o&&(this.setValue("reputationTotal",o),this.setValue("reputationIncrease",'<a href="/?act=rep&CODE=01&mid='+j+'&t=p">'+this.config.reputationIncrease+"</a>"),this.setValue("reputationDecrease",'<a href="/?act=rep&CODE=02&mid='+j+'&t=p">'+this.config.reputationDecrease+"</a>"),this.setValue("reputationDetails",'<a href="/?act=rep&CODE=03&mid='+j+'">'+this.config.reputationDetails+"</a>"))}this.setValue("userTitle",k[10+n].textContent),this.setValue("location",k[12+n].textContent.split("Location: ")[1]),this.setValue("birthday",k[13+n].textContent.split("Born: ")[1]),this.setValue("homePage",k[14+n].innerHTML.split("Website: ")[1]),this.config.htmlEnabled?this.setValue("interests",this.stringToMarkup(k[16+n].innerHTML)):this.setValue("interests",k[16+n].innerHTML);for(var p=e.getElementsByTagName("div"),q=1,r=p.length;r>q;q++){if(this.config.customFieldsInnerHTML)var s=p[q].innerHTML.split(": ")[1];else var s=p[q].textContent.split(": ")[1];this.setValue("customField"+q,s)}var t=f.getElementsByTagName("div");this.setValue("joinDate",t[1].textContent.split("Joined: ")[1]),this.setValue("onlineStatus",t[2].textContent.split("(")[1].split(")")[0]),-1===t[2].textContent.split("(")[1].split(")")[0].indexOf("Offline")?this.setValue("onlineActivity",t[2].textContent.split(") (")[1].split(")")[0]):this.setValue("onlineActivity",this.config.onlineActivityDefault),this.setValue("lastActivity",t[3].textContent.split(": ")[1]),this.setValue("localTime",t[4].textContent.split(": ")[1]),this.setValue("postCount",t[5].textContent.split("posts")[0]),this.setValue("postsPerDay",t[5].textContent.split("(")[1].split(" per")[0]);var u=g.getElementsByTagName("div");this.setValue("userAIM",u[1].textContent),this.setValue("userYahoo",u[2].textContent),this.setValue("userGtalk",u[3].textContent),this.setValue("userMSN",u[4].textContent),this.setValue("userSkype",u[5].textContent),-1!==u[6].textContent.indexOf("Click")?this.setValue("sendMessage",'<a href="/?act=Msg&amp;CODE=00&amp;MID='+j+'">'+this.config.messageDefault+"</a>"):this.setValue("sendMessage","Private"),-1!==u[7].textContent.indexOf("Click")?this.setValue("sendEmail",'<a href="/?act=Mail&amp;CODE=00&amp;MID='+j+'">'+this.config.emailDefault+"</a>"):this.setValue("sendEmail","Private");var v=h.getElementsByTagName("td");this.setValue("signature",v[2].innerHTML);var w=i.getElementsByTagName("h3");this.setValue("userName",w[0].textContent);var x=i.getElementsByTagName("strong");this.setValue("userGroup",x[0].textContent);var y=i.previousElementSibling.getElementsByTagName("img")[0];y?this.setValue("avatar",y.src):this.setValue("avatar",this.config.avatarDefault);var z=document.createElement("div");z.innerHTML=this.replaceValues(this.html,this.values),z.id="new-profile",c.parentNode.appendChild(z),c.parentNode.removeChild(c)}else if(b){var A=b.parentNode.parentNode.parentNode.parentNode,B=A.nextElementSibling,C=B.nextElementSibling,D=C.nextElementSibling,E=D.nextElementSibling;A.style.display="none",B.style.display="none",C.style.display="none",D.style.display="none",E.style.display="none";var j=location.href.split("?showuser=")[1];this.setValue("userId",j);var F=A.getElementsByTagName("td"),l=F[0].getElementsByTagName("img")[0],G=F[1].getElementsByTagName("div");l?this.setValue("userPhoto",l.src):this.setValue("userPhoto",this.config.userPhotoDefault),this.setValue("userName",G[0].textContent);var H=C.getElementsByTagName("table"),I=H[0],J=H[1],K=H[2],L=H[3],M=I.getElementsByTagName("td");this.setValue("postCount",M[2].textContent.split("(")[0]),this.setValue("postsPerDay",M[4].textContent),this.setValue("joinDate",M[6].textContent),this.setValue("localTime",M[8].textContent);var N=M[10].textContent;this.setValue("onlineStatus",N.split("(")[1].split(")")[0]),-1===N.split("(")[1].split(")")[0].indexOf("Offline")?this.setValue("onlineActivity",N.split(") (")[1].split(")")[0]):this.setValue("onlineActivity",this.config.onlineActivityDefault);var O=J.getElementsByTagName("td");-1!==O[2].textContent.indexOf("Click")?this.setValue("sendEmail",'<a href="/?act=Mail&amp;CODE=00&amp;MID='+j+'">Click here</a>'):this.setValue("sendEmail","Private"),this.setValue("userSkype",O[4].textContent),this.setValue("userAIM",O[6].textContent),this.setValue("userGtalk",O[8].textContent),this.setValue("userYahoo",O[10].textContent),this.setValue("userMSN",O[12].textContent),-1!==O[14].textContent.indexOf("Click")?this.setValue("sendMessage",'<a href="/?act=Msg&amp;CODE=04&amp;MID='+j+'">Click here</a>'):this.setValue("sendMessage","Private");var P=K.getElementsByTagName("td");this.setValue("homePage",P[2].innerHTML),this.setValue("birthday",P[4].textContent),this.setValue("location",P[6].textContent),this.config.htmlEnabled?this.setValue("interests",this.stringToMarkup(P[8].innerHTML)):this.setValue("interests",P[8].innerHTML);var Q=0;-1!==P[9].textContent.indexOf("Awards")&&(Q=2,this.setValue("awards",P[10].innerHTML)),this.setValue("lastActivity",P[12+Q].textContent);for(var q=14+Q,R=1;q<P.length;q+=2,R++){if(this.config.customFieldsInnerHTML)var s=P[q].innerHTML;else var s=P[q].textContent;this.setValue("customField"+R,s)}var S=L.getElementsByTagName("td");this.setValue("userGroup",S[2].textContent),this.setValue("userTitle",S[4].textContent);var y=S[6].getElementsByTagName("img")[0];y?this.setValue("avatar",y.src):this.setValue("avatar",this.config.avatarDefault);for(var q=7;q<S.length;q++)switch(!0){case"Rep:"===S[q].textContent:var T=S[q+1].textContent;-1!==T.indexOf("pts")?this.setValue("reputationTotal",T.split("pts [")[0]):this.setValue("reputationTotal","0"),this.setValue("reputationIncrease",'<a href="/?act=rep&CODE=01&mid='+j+'&t=p">'+this.config.reputationIncrease+"</a>"),this.setValue("reputationDecrease",'<a href="/?act=rep&CODE=02&mid='+j+'&t=p">'+this.config.reputationDecrease+"</a>"),this.setValue("reputationDetails",'<a href="/?act=rep&CODE=03&mid='+j+'">'+this.config.reputationDetails+"</a>");break;case"Warn Level"===S[q].textContent:this.setValue("warnLevel",S[q+1].textContent.split("%")[0]),this.setValue("warnLevelIncrease",'<a href="/?act=warn&type=add&mid='+j+'">'+this.config.warnIncrease+"</a>"),this.setValue("warnLevelDecrease",'<a href="/?act=warn&type=minus&mid='+j+'">'+this.config.warnDecrease+"</a>")}var U=D.getElementsByTagName("td");this.setValue("signature",U[2].innerHTML);var z=document.createElement("div");z.innerHTML=this.replaceValues(this.html,this.values),z.id="new-profile",A.parentNode.appendChild(z),A.parentNode.removeChild(A),B.parentNode.removeChild(B),C.parentNode.removeChild(C),D.parentNode.removeChild(D),E.parentNode.removeChild(E)}},$cs.module.Profile.prototype.initialize=function(a){$cs.module.Default.prototype.initialize.call(this,a)},$cs.module.Profile.prototype.stringToMarkup=function(a){var b=document.createElement("div");b.innerHTML=a;for(var c="",d=0,e=b.childNodes.length;e>d;d++)b.childNodes[d].nodeValue&&(c+=b.childNodes[d].nodeValue);return b="",c},$cs.extendModule($cs.module.Topics,$cs.module.Default),$cs.module.Topics.prototype.config={keyPrefix:"{{",keySuffix:"}}",announcementsDefault:"Announcements",pinnedDefault:"Important Topics",regularDefault:"Forum Topics",noTopics:"No topics were found. This is either because there are no topics in this forum, or the topics are older than the current age cut-off.",noActiveTopics:"There were no active topics during those date ranges",paginationDefault:"",activeTopics:!1},$cs.module.Topics.prototype.name="$cs.module.Topics",$cs.module.Topics.prototype.reserved=["values","execute","getValue","hasValue","initialize","replaceValues","setValue"],$cs.module.Topics.prototype.execute=function(){var a=document.getElementById("topic-list");if(!a&&this.config.activeTopics&&window.location.href.indexOf("act=Search&CODE=getactive")>-1){for(var b=document.getElementsByTagName("form"),c=0;c<b.length;c++)b[c].action.indexOf("act=Search&CODE=getactive")>-1&&(a=b[c].nextElementSibling.nextElementSibling);var d=!0}if(a){for(var e=a.getElementsByTagName("table")[0],f=[],g="",h=" regular-topic",i=0;i<e.firstElementChild.childNodes.length;i++)1===e.firstElementChild.childNodes[i].nodeType&&"TR"===e.firstElementChild.childNodes[i].tagName&&f.push(e.firstElementChild.childNodes[i]);e.style.display="none";for(var c=1,j=f.length;j>c;c++){var k=f[c].getElementsByTagName("td");if(k[3]){if(d){if(this.config.activeTopics){this.setValue("folder",k[0].innerHTML),this.setValue("marker",k[1].innerHTML);var l=k[2].getElementsByTagName("a");if(-1===l[0].href.indexOf("view=getnewpost"))var m=l[0];else var m=l[1];this.setValue("topicId",m.getAttribute("href").split("showtopic=")[1].split("&")[0]),this.setValue("topicTitle",'<a href="'+m+'">'+m.textContent+"</a>");var n=k[2].getElementsByTagName("span");-1!==n[0].textContent.indexOf("(Pages ")?(this.setValue("pagination",n[0].innerHTML),this.setValue("topicDescription",n[1].textContent)):(this.setValue("pagination",this.config.paginationDefault),this.setValue("topicDescription",n[0].textContent)),this.setValue("parentForum",k[5].innerHTML),this.setValue("topicAuthor",k[6].innerHTML),this.setValue("replyCount",k[7].textContent),this.setValue("viewCount",k[8].textContent),this.setValue("lastReplyDate",k[9].firstChild.nodeValue),this.setValue("lastReplyDate",k[9].firstChild.nodeValue);var o=k[9].getElementsByTagName("b");o[1]?this.setValue("lastReplyAuthor",o[1].innerHTML):this.setValue("lastReplyAuthor",o[0].innerHTML),this.setValue("moderatorCheckbox","")}}else{this.setValue("folder",k[0].innerHTML),this.setValue("marker",k[1].innerHTML);var m=k[2].getElementsByTagName("a")[0];m.getAttribute("title")||(m=k[2].getElementsByTagName("a")[1]),this.setValue("topicId",m.getAttribute("href").split("showtopic=")[1]),this.setValue("topicTitle",'<a href="'+m+'">'+m.textContent+"</a>");var n=k[2].getElementsByTagName("span");-1!==n[0].textContent.indexOf("(Pages ")?(this.setValue("pagination",n[0].innerHTML),this.setValue("topicDescription",n[1].textContent)):(this.setValue("pagination",this.config.paginationDefault),this.setValue("topicDescription",n[0].textContent));var p=a.firstElementChild.textContent.trim(),q='<a href="'+window.location.href+'">'+p+"</a>";this.setValue("parentForum",q),this.setValue("topicAuthor",k[3].innerHTML),this.setValue("replyCount",k[4].textContent),this.setValue("viewCount",k[5].textContent),this.setValue("lastReplyDate",k[6].getElementsByTagName("span")[0].firstChild.nodeValue),this.setValue("lastReplyAuthor",k[6].getElementsByTagName("b")[0].innerHTML),this.setValue("moderatorCheckbox",k[7].innerHTML)}g+='<div class="topic-row'+h+'">'+this.replaceValues(this.html,this.values)+"</div>"}else if(c===j-1||d)d?this.config.activeTopics&&(g+='<div class="no-topics">'+this.config.noActiveTopics+"</div>"):g+='<div class="no-topics">'+this.config.noTopics+"</div>";else{var r=k[2].getElementsByTagName("b")[0].textContent;switch(r){case"Announcements":h=" announcement-topic",g+='<div class="topic-title-row">'+this.config.announcementsDefault+"</div>";break;case"Important Topics":h=" pinned-topic",g+='<div class="topic-title-row">'+this.config.pinnedDefault+"</div>";break;default:h=" regular-topic",g+='<div class="topic-title-row">'+this.config.regularDefault+"</div>"}}}var s=document.createElement("div");s.id="new-topics",s.innerHTML=g,e.parentNode.insertBefore(s,e),e.parentNode.removeChild(e),this.config.activeTopics&&d&&a.removeChild(a.lastElementChild)}},$cs.module.Topics.prototype.initialize=function(a){$cs.module.Default.prototype.initialize.call(this,a)},$cs.extendModule($cs.module.Posts,$cs.module.Default),$cs.module.Posts.prototype.config={keyPrefix:"{{",keySuffix:"}}",permaLinkDefault:"Permalink",postSignatureDefault:"",quickEdit:!1,formatQuoteCodeTags:!1},$cs.module.Posts.prototype.name="$cs.module.Posts",$cs.module.Posts.prototype.reserved=["attachCodeEventListeners","createEditForm","execute","Fetch","formatQuoteCodeTags","getValue","hasValue","initialize","queryString","replaceValues","setValue","values"],$cs.module.Posts.prototype.queryString=function(a,b){b=b.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var c=new RegExp("[\\?&]"+b+"=([^&#]*)"),d=c.exec(a);return null===d?"":decodeURIComponent(d[1].replace(/\+/g," "))},$cs.module.Posts.prototype.Fetch={request:function(){return new(XMLHttpRequest||ActiveXObject)("MSXML2.XMLHTTP.3.0")},get:function(a,b){var c=this.request();c.open("GET",a),c.setRequestHeader("X-Requested-With","XMLHttpRequest"),c.onreadystatechange=function(){c.readyState>3&&b&&"function"==typeof b&&b(c.responseText)},c.send()},post:function(a,b,c){var d=this.request(),b=this.formatData(b);d.open("POST",a),d.setRequestHeader("X-Requested-With","XMLHttpRequest"),d.setRequestHeader("Content-type","application/x-www-form-urlencoded"),d.setRequestHeader("Content-length",b.length),d.onreadystatechange=function(){d.readyState>3&&c&&"function"==typeof c&&c(d.responseText)},d.send(b)},filter:function(a){for(var b="",c=0;c<a.length;c++){var d=a.charCodeAt(c);b+=d>127?"&#"+d+";":a.charAt(c)}return encodeURIComponent?encodeURIComponent(b):escape(b)},formatData:function(a){var b=[];for(var c in a)b.push(this.filter(c)+"="+this.filter(a[c]));return b.join("&")}},$cs.module.Posts.prototype.createEditForm=function(a,b,c,d,e,f){var g=document.createElement("form"),h=document.createElement("textarea"),i=document.createElement("div"),j=document.createElement("button"),k=document.createElement("button"),l=document.createElement("button");g.addEventListener("submit",function(a){a.preventDefault()});var m=document.createElement("div");m.innerHTML=e;var n=m.firstElementChild.value,o=m.lastElementChild.value;h.innerHTML=o,h.style.boxSizing="border-box",j.innerHTML="Edit",k.innerHTML="Cancel",l.innerHTML="Full Edit";var p=function(a){var b="(?:<!-- THE POST "+c+" -->\\s*<div class=['\"]postcolor['\"]>)((?:.|\n)*?)(?: </div>\n {8}(?:<br(?:\\s*/)>){2}(?:.|\n)*?(?:<br(?:\\s*/)>\n<div class=['\"]signature['\"]>)|(?:</div>\\s*<!-- THE POST -->))",d=new RegExp(b).exec(a);if(!d)return void console.error("Could not GET edited post. Read failed.");var e=document.createElement("div");if(e.classList.add("cs-quick-edit"),e.innerHTML=d[1],j.parentNode.parentNode.parentNode.replaceChild(e,j.parentNode.parentNode),this.config.formatQuoteCodeTags){var f=e.getElementsByTagName("table");this.formatQuoteCodeTags(f),this.attachCodeEventListeners()}},q=function(e){e.preventDefault();var f="/?act=Post&quickedit=1&CODE=09&f="+a+"&t="+b+"&p="+c+"&st="+d+"&auth_key="+n,g={enablesig:"yes",Post:h.value};this.Fetch.post(f,g,function(a){var b=document.createElement("div");b.innerHTML=a;var c=b.getElementsByTagName("a");if(1!==c.length)return void console.error("Couldn't POST changes. Edit failed.");var d=c[0].href+"&nocache="+(new Date).getTime();this.Fetch.get(d,p.bind(this))}.bind(this))};return j.addEventListener("click",q.bind(this)),k.addEventListener("click",function(a){a.preventDefault(),this.parentNode.parentNode.parentNode.replaceChild(f,this.parentNode.parentNode)}),l.addEventListener("click",function(e){e.preventDefault(),window.location.href="/?act=Post&CODE=08&f="+a+"&t="+b+"&p="+c+"&st="+d}.bind(this)),i.appendChild(j),i.appendChild(k),i.appendChild(l),g.appendChild(h),g.appendChild(i),g},$cs.module.Posts.prototype.formatQuoteCodeTags=function(a){for(var b=a.length;b>-1;b--)if("undefined"!=typeof a[b]&&"QUOTE-WRAP"==a[b].id){a[b].style.display="none";var c=a[b].firstElementChild.firstElementChild.firstElementChild.innerHTML.slice(14,-1).split(" @ "),d=c[0],e=c[1];d||(d=""),e||(e="");var f=a[b].firstElementChild.lastElementChild.firstElementChild.innerHTML,g=document.createElement("div");g.classList.add("quote-wrapper"),g.innerHTML='<div class="quote-title"><span class="quote-author">'+d+'</span><span class="quote-timestamp">'+e+'</span></div><div class="quote-contents"><blockquote>'+f+"</blockquote></div>",a[b].parentNode.insertBefore(g,a[b].nextSibling),a[b].parentNode.removeChild(a[b])}else if("undefined"!=typeof a[b]&&"CODE-WRAP"==a[b].id){a[b].style.display="none";var h=a[b].firstElementChild.lastElementChild.firstElementChild.innerHTML,i=document.createElement("div");i.classList.add("code-wrapper");var j=document.createElement("code");j.classList.add("code-title"),j.style.cursor="pointer",j.appendChild(document.createTextNode("Code (Click to highlight)")),i.appendChild(j);var k=document.createElement("div"),l=document.createElement("pre"),m=document.createElement("code");m.innerHTML=h,l.appendChild(m),k.appendChild(l),k.classList.add("code-contents"),i.appendChild(k),a[b].parentNode.insertBefore(i,a[b].nextSibling),a[b].parentNode.removeChild(a[b])}},$cs.module.Posts.prototype.attachCodeEventListeners=function(){for(var a=document.getElementsByClassName("code-wrapper"),b=0,c=a.length;c>b;b++)a[b].firstElementChild.addEventListener("click",function(a){a.preventDefault();var b,c;document.body.createTextRange?(b=document.body.createTextRange(),b.moveToElementText(this.nextElementSibling),b.select()):window.getSelection&&(c=window.getSelection(),b=document.createRange(),b.selectNodeContents(this.nextElementSibling),c.removeAllRanges(),c.addRange(b))})},$cs.module.Posts.prototype.execute=function(){if(-1!==window.location.href.indexOf("showtopic")||-1!==window.location.href.indexOf("ST")){var a=document.getElementsByClassName("post-normal"),b=document.createElement("div");b.id="new-posts";for(var c=0,d=a.length;d>c;c++){a[c].style.display="none";for(var e=a[c].firstElementChild,f=e.getElementsByTagName("tr"),g=[],h=0,i=f.length;i>h;h++)for(var j=f[h].childNodes,k=0,l=j.length;l>k;k++){var m=j[k];1===m.nodeType&&"TD"===m.tagName&&m.parentNode.parentNode.parentNode===e&&g.push(m)}var n,o=g[0].getElementsByTagName("a"),p=o[0].name.split("entry")[1];n=-1!==window.location.search.indexOf("showtopic")?this.queryString(window.location.search,"showtopic"):this.queryString(window.location.search,"t"),this.setValue("postId",p),o.length>1?this.setValue("postAuthor",g[0].innerHTML.split('normalname">')[1].slice(0,-7)):this.setValue("postAuthor",g[0].innerHTML.split('unreg">')[1].slice(0,-7)),this.setValue("permaLink",'<a href="/?showtopic='+n+"&amp;view=findpost&amp;p="+p+'">'+this.config.permaLinkDefault+"</a>"),this.setValue("postDate",g[1].firstElementChild.textContent.split("Posted: ")[1]),this.setValue("postButtonsTop",g[1].lastElementChild.innerHTML);var q=0;-1!==g[2].innerHTML.indexOf("input")?(this.setValue("postCheckbox",g[2].innerHTML),q=1):this.setValue("postCheckbox",""),this.setValue("postMiniprofile",g[2+q].firstElementChild.innerHTML),this.config.quickEdit?this.setValue("postContent",'<div class="cs-quick-edit">'+g[3+q].firstElementChild.innerHTML+"</div>"):this.setValue("postContent",g[3+q].firstElementChild.innerHTML);var r=g[3+q].lastElementChild;r.previousElementSibling?this.setValue("postSignature",r.innerHTML):this.setValue("postSignature",this.config.postSignatureDefault),this.setValue("postIp",g[4+q].textContent),this.setValue("postButtonsBottom",g[5+q].firstElementChild.innerHTML);var s=document.createElement("div");if(s.id="entry"+p,s.classList.add("new-post",a[c].classList[1]),s.innerHTML=this.replaceValues(this.html,this.values),b.appendChild(s),this.config.quickEdit)for(var o=s.getElementsByTagName("a"),t=0;t<o.length;t++)-1!==o[t].href.indexOf("act=Post&CODE=08")&&o[t].addEventListener("click",function(a){a.preventDefault();var b=this.queryString(a.currentTarget.href,"f"),c=this.queryString(a.currentTarget.href,"t"),d=this.queryString(a.currentTarget.href,"p"),e=this.queryString(a.currentTarget.href,"st")||"0",f="/?&act=Post&CODE=08&f="+b+"&t="+c+"&p="+d+"&st="+e+"&quickedit=1",g=document.getElementById("entry"+d).getElementsByClassName("cs-quick-edit")[0];this.Fetch.get(f,function(a){var f=this.createEditForm(b,c,d,e,a,g);g.parentNode.replaceChild(f,g)}.bind(this))}.bind(this));if(this.config.formatQuoteCodeTags){var u=s.getElementsByTagName("table");this.formatQuoteCodeTags(u)}}a[0].parentNode.insertBefore(b,a[0]),e.parentNode.removeChild(e)}this.config.formatQuoteCodeTags&&this.attachCodeEventListeners()},$cs.module.Posts.prototype.initialize=function(a){$cs.module.Default.prototype.initialize.call(this,a)};var customIndex=new $cs.module.Index,customStats=new $cs.module.Stats,customProfile=new $cs.module.Profile,customTopics=new $cs.module.Topics,customPosts=new $cs.module.Posts;